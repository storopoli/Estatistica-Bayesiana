<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Estatística Bayesiana com R e Stan: Modelos Multiníveis Bayesianos</title>

  <meta property="description" itemprop="description" content="Modelos Multiníveis ou Modelos Hierárquicos"/>

  <link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"/>

  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-08-01"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-08-01"/>
  <meta name="article:author" content="Jose Storopoli"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Estatística Bayesiana com R e Stan: Modelos Multiníveis Bayesianos"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Modelos Multiníveis ou Modelos Hierárquicos"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Estatística Bayesiana com R e Stan"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Estatística Bayesiana com R e Stan: Modelos Multiníveis Bayesianos"/>
  <meta property="twitter:description" content="Modelos Multiníveis ou Modelos Hierárquicos"/>

  <!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
  <meta name="citation_title" content="Estatística Bayesiana com R e Stan: Modelos Multiníveis Bayesianos"/>
  <meta name="citation_fulltext_html_url" content="https://storopoli.io/Estatistica-Bayesiana/10-Regressao_Multinivel.html"/>
  <meta name="citation_fulltext_world_readable" content=""/>
  <meta name="citation_online_date" content="2021/08/01"/>
  <meta name="citation_publication_date" content="2021/08/01"/>
  <meta name="citation_author" content="Jose Storopoli"/>
  <meta name="citation_author_institution" content="UNINOVE"/>
  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Bayesian Data Analysis;citation_publication_date=2013;citation_publisher=Chapman and Hall/CRC;citation_author=Andrew Gelman;citation_author=John B Carlin;citation_author=Hal S Stern;citation_author=David B Dunson;citation_author=Aki Vehtari;citation_author=Donald B Rubin"/>
  <meta name="citation_reference" content="citation_title=Skimr: Compact and flexible summaries of data;citation_publication_date=2021;citation_author=Elin Waring;citation_author=Michael Quinn;citation_author=Amelia McNamara;citation_author=Eduardo Arino de la Rubia;citation_author=Hao Zhu;citation_author=Shannon Ellis"/>
  <meta name="citation_reference" content="citation_title=Fitting linear mixed-effects models using lme4;citation_publication_date=2015;citation_volume=67;citation_doi=10.18637/jss.v067.i01;citation_author=Douglas Bates;citation_author=Martin Mächler;citation_author=Ben Bolker;citation_author=Steve Walker"/>
  <meta name="citation_reference" content="citation_title=Account-level modeling for trade promotion: An application of a constrained parameter hierarchical model;citation_publication_date=1999;citation_publisher=Taylor &amp; Francis;citation_volume=94;citation_author=Peter Boatwright;citation_author=Robert McCulloch;citation_author=Peter Rossi"/>
  <meta name="citation_reference" content="citation_title=Generating random correlation matrices based on vines and extended onion method;citation_publication_date=2009;citation_publisher=Elsevier;citation_volume=100;citation_author=Daniel Lewandowski;citation_author=Dorota Kurowicka;citation_author=Harry Joe"/>
  <meta name="citation_reference" content="citation_title=Analyzing ecological data;citation_publication_date=2007;citation_publisher=Springer;citation_author=Alain Zuur;citation_author=Elena N Ieno;citation_author=Graham M Smith"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","citation_url","slug","bibliography","csl"]}},"value":[{"type":"character","attributes":{},"value":["Modelos Multiníveis Bayesianos"]},{"type":"character","attributes":{},"value":["Modelos Multiníveis ou Modelos Hierárquicos"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Jose Storopoli"]},{"type":"character","attributes":{},"value":["https://scholar.google.com/citations?user=xGU7H1QAAAAJ&hl=en"]},{"type":"character","attributes":{},"value":["UNINOVE"]},{"type":"character","attributes":{},"value":["https://www.uninove.br"]},{"type":"character","attributes":{},"value":["0000-0002-0559-5176"]}]}]},{"type":"character","attributes":{},"value":["August 1, 2021"]},{"type":"character","attributes":{},"value":["https://storopoli.io/Estatistica-Bayesiana/10-Regressao_Multinivel.html"]},{"type":"character","attributes":{},"value":["storopoli2021regressaomultinivelbayesR"]},{"type":"character","attributes":{},"value":["bib/bibliografia.bib"]},{"type":"character","attributes":{},"value":["bib/apa.csl"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  @import url('https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css')</style>
  <style type="text/css">
  /* base style */

  /* FONT FAMILIES */

  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }

  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }

  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }


  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }

  d-title h1 {
    font-size: var(--title-size, 50px);
  }

  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }

  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }


  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }

  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }

  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }

  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }

  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }

  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }

  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }

  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }

  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }

  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }

  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }

  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=G-K886N00L87"></script>
  <script type="text/javascript" cookie-consent="tracking">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-K886N00L87');
  </script>
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Modelos Multiníveis Bayesianos","description":"Modelos Multiníveis ou Modelos Hierárquicos","authors":[{"author":"Jose Storopoli","authorURL":"https://scholar.google.com/citations?user=xGU7H1QAAAAJ&hl=en","affiliation":"UNINOVE","affiliationURL":"https://www.uninove.br","orcidID":"0000-0002-0559-5176"}],"publishedDate":"2021-08-01T00:00:00.000+00:00","citationText":"Storopoli, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://www.uninove.br">
<img src="images/uninove.png" alt="Logo"/>
</a>
<a href="index.html" class="title">Estatística Bayesiana com R e Stan</a>
<a href="0-Estatistica-Bayesiana.html">O que é Estatística Bayesiana?</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Tutoriais
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="1-Comandos_Basicos.html">1. Comandos Básicos de R</a>
<a href="2-Distribuicoes_Estatisticas.html">2. Distribuições Estatísticas</a>
<a href="3-rstanarm.html">3. rstanarm e brms</a>
<a href="4-Priors.html">4. Priors</a>
<a href="5-MCMC.html">5. Markov Chain Montecarlo (MCMC)</a>
<a href="6-Regressao_Linear.html">6. Regressão Linear</a>
<a href="7-Regressao_Logistica.html">7. Regressão Logística</a>
<a href="8-Regressao_Poisson.html">8. Regressão de Poisson</a>
<a href="9-Regressao_Robusta.html">9. Regressão Robusta</a>
<a href="10-Regressao_Multinivel.html">10. Modelos Multiníveis</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Conteúdos Auxiliares
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="aux-Model_Comparison.html">Comparação de Modelos</a>
<a href="aux-Dados_Faltantes.html">Dados Faltantes</a>
<a href="aux-Regressao_Coeficientes.html">Coeficientes de uma Regressão</a>
<a href="aux-Tabelas_para_Publicacao.html">Tabelas para Publicação</a>
</div>
</div>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="https://scholar.google.com/citations?user=xGU7H1QAAAAJ&amp;hl=en">
<i class="fa ai ai-google-scholar ai-lg" aria-hidden="true"></i>
</a>
<a href="https://orcid.org/0000-0002-0559-5176">
<i class="fa ai ai-orcid ai-lg" aria-hidden="true"></i>
</a>
<a href="http://lattes.cnpq.br/2281909649311607">
<i class="fa ai ai-lattes ai-lg" aria-hidden="true"></i>
</a>
<a href="https://github.com/storopoli/Estatistica-Bayesiana" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Modelos Multiníveis Bayesianos</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p>Modelos Multiníveis ou Modelos Hierárquicos</p>
</div>

<div class="d-byline">
  Jose Storopoli <a href="https://scholar.google.com/citations?user=xGU7H1QAAAAJ&amp;hl=en" class="uri">https://scholar.google.com/citations?user=xGU7H1QAAAAJ&amp;hl=en</a> (UNINOVE)<a href="https://www.uninove.br" class="uri">https://www.uninove.br</a>
  
<br/>August 1, 2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#quando-usar-modelos-multiníveis">Quando usar Modelos Multiníveis?</a></li>
<li><a href="#hiperpriori-hyperprior"><em>Hiperpriori</em> (<em>Hyperprior</em>)</a></li>
<li><a href="#abordagem-frequentista-vs-abordagem-bayesiana">Abordagem Frequentista vs Abordagem Bayesiana</a></li>
<li><a href="#três-abordagens-de-modelos-multiníveis">Três abordagens de Modelos Multiníveis</a>
<ul>
<li><a href="#random-intercept-model"><em>Random Intercept Model</em></a></li>
<li><a href="#random-slope-model"><em>Random Slope Model</em></a></li>
<li><a href="#random-intercept-slope-model"><em>Random Intercept-Slope Model</em></a></li>
</ul></li>
<li><a href="#prioris-de-modelos-multiníveis"><em>Prioris</em> de Modelos Multiníveis</a></li>
<li><a href="#exemplo-com-o-dataset-cheese">Exemplo com o <em>dataset</em> <code>cheese</code></a>
<ul>
<li><a href="#random-intercept-model-1"><em>Random Intercept Model</em></a></li>
<li><a href="#random-slope-model-1"><em>Random Slope Model</em></a></li>
<li><a href="#random-intercept-slope-model-1"><em>Random Intercept-Slope Model</em></a></li>
</ul></li>
<li><a href="#modelos-multiníveis-no-brms">Modelos multiníveis no <code>brms</code></a></li>
<li><a href="#atividade-prática">Atividade Prática</a></li>
<li><a href="#ambiente">Ambiente</a></li>
</ul>
</nav>
</div>
<p><link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css"/></p>
<p>Modelos hierárquicos Bayesianos (também chamados de modelos multiníveis) são um modelo estatístico escrito em níveis <em>múltiplos</em> (forma hierárquica) que estima os parâmetros da distribuição posterior usando a abordagem Bayesiana. Os submodelos se combinam para formar o modelo hierárquico, e o teorema de Bayes é usado para integrá-los aos dados observados e contabilizar toda a incerteza que está presente. O resultado dessa integração é a distribuição posterior, também conhecida como estimativa de probabilidade atualizada, à medida que evidências adicionais da função de verossimilhança são integradas juntamente com a distribuição <em>priori</em> dos parâmetros.</p>
<p>A modelagem hierárquica é usada quando as informações estão disponíveis em vários níveis diferentes de unidades de observação. A forma hierárquica de análise e organização auxilia no entendimento de problemas multiparâmetros e também desempenha um papel importante no desenvolvimento de estratégias computacionais.</p>
<p>Os modelos hierárquicos são descrições matemáticas que envolvem vários parâmetros, de modo que as estimativas de alguns parâmetros dependem significativamente dos valores de outros parâmetros. A figura <a href="#fig:fig-hierarchical">1</a> mostra um modelo hierárquico no qual há um hiperparamêtro <span class="math inline">\(\phi\)</span> que parametriza os parâmetros <span class="math inline">\(\theta_1, \theta_2, \dots, \theta_N\)</span> que por fim são usados para inferir a densidade posterior de alguma variável de interesse <span class="math inline">\(\mathbf{y} = y_1, y_2, \dots, y_N\)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:fig-hierarchical"></span>
<img src="images/hierarchical.png" alt="Modelo Hierárquico" width="342" />
<p class="caption">
Figure 1: Modelo Hierárquico
</p>
</div>
</div>
<h2 id="quando-usar-modelos-multiníveis">Quando usar Modelos Multiníveis?</h2>
<p>Modelos multiníveis são particularmente apropriados para projetos de pesquisa onde os dados dos participantes são organizados em mais de um nível (ou seja, dados aninhados – <em>nested data</em>). As unidades de análise geralmente são indivíduos (em um nível inferior) que estão aninhados em unidades contextuais/agregadas (em um nível superior). Um exemplo é quando estamos mensurando desempenho de indivíduos e temos informações adicionais sobre pertencimento à grupos distintos como sexo, faixa etária, nível hierárquico, nível educacional ou estado de moradia.</p>
<p>Há um pressuposto principal que não pode ser violado em modelos multiníveis que é o de <strong>permutabilidade</strong><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span class="citation" data-cites="definettiTheoryProbability1974 nauFinettiWasRight2001">(<a href="#ref-definettiTheoryProbability1974" role="doc-biblioref">de Finetti, 1974</a>; <a href="#ref-nauFinettiWasRight2001" role="doc-biblioref">Nau, 2001</a>)</span>. Sim, esse é o mesmo pressuposto que discutimos na <a href="0-Estatistica-Bayesiana.html">Aula 0 - O que é Estatística Bayesiana</a>. Esse pressuposto parte do princípio que os grupos são permutáveis. A figura <a href="#fig:exchangeability">2</a> mostra uma representação gráfica da permutabilidade. Os grupos mostrados como “copos” que contém observações mostradas como “bolas.” Se esse pressuposto é violado na sua inferência, então modelos multiníveis não são apropriados. Isto quer dizer que, uma vez que não há justificação teórica para sustentar a permutabilidade, as inferências do modelo multinível não são robustas e o modelo pode sofrer de diversas patologias e não deve ser usado para qualquer análise científica ou prática.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:exchangeability"></span>
<img src="10-Regressao_Multinivel_files/figure-html5/exchangeability-1.png" alt="Permutabilidade -- Figuras de Michael Betancourt -- https://betanalpha.github.io/" width="100%" class=external />
<p class="caption">
Figure 2: Permutabilidade – Figuras de Michael Betancourt – <a href="https://betanalpha.github.io/" class="uri">https://betanalpha.github.io/</a>
</p>
</div>
</div>
<h2 id="hiperpriori-hyperprior"><em>Hiperpriori</em> (<em>Hyperprior</em>)</h2>
<p>Como as <em>prioris</em> dos parâmetros são amostradas de uma outra <em>priori</em> do hiperparâmetro (parâmetro do nível superior), as <em>prioris</em> do nível superior são chamadas de <em>hiperprioris</em> (do inglês <em>hyperprior</em>). Isso faz com que estimativas de um grupo ajudem o modelo a estimar melhor os outros grupos proporcionando estimativas mais robustas e estáveis.</p>
<p>Chamamos os parâmetros globais de efeitos populacionais (<em>population-level effects</em>, também às vezes chamados de efeitos fixos, <em>fixed effects</em>) e os parâmetros de cada grupo de efeitos de grupo (<em>group-level effects</em>, também às vezes chamados de efeitos aleatórios, <em>random effects</em>). Por isso que os modelos multiníveis são conhecidos também como modelos mistos (<em>mixed models</em>) no qual temos efeitos fixos e efeitos aleatórios.</p>
<h2 id="abordagem-frequentista-vs-abordagem-bayesiana">Abordagem Frequentista vs Abordagem Bayesiana</h2>
<p>Existem modelos multíveis também na estatística frequentista. Todos esses estão disponíveis no pacote <code>lme4</code> <span class="citation" data-cites="lme4">(<a href="#ref-lme4" role="doc-biblioref">Bates, Mächler, Bolker, &amp; Walker, 2015</a>)</span>. <code>rstanarm</code> e <code>brms</code> usam a mesma síntaxe de fórmula do <code>lme4</code> para especificar parâmetros populacionais e parâmetros de grupo. Mas aqui há uma grande diferença da abordagem frequentista vs a abordagem Bayesiana.</p>
<p>Primeiro, a abordagem frequentista (como já cobrimos na <a href="0-Estatistica-Bayesiana.html">Aula 0 - O que é Estatística Bayesiana</a>) usa um procedimento de otimização da função de verossimilhança na qual busca-se o conjunto de parâmetros que maximizam a função de verossimilhança do modelo. Na prática isso significa achar a moda de todos os parâmetros condicionados na função de verossimilhança que, pelo pressuposto de que todos os parâmetros são distribuídos como uma distribuição normal e também por conta do pressuposto de erros gaussianos, equivale à média e à mediana do parâmetro (note que na distribuição normal média, mediana e moda possuem o mesmo valor). Procure em fóruns de estatística ou no <em>stackoverflow</em> e você achará um monte de perguntas e pedidos de ajuda sobre modelos multiníveis <code>lme4</code> que não convergem. Aliás, muitos são convencidos para a abordagem Bayesiana (e se tornam Bayesianos) quando eles tentam executar o mesmo modelo <code>lme4</code> que falhou a convergência no <code>rstanarm</code> ou <code>brms</code> (lembrando que a síntaxe da fórmula é a mesma, então é muito fácil traduzir modelos frequentistas do <code>lme4</code> para modelos bayesianos do <code>rstanarm</code> e <code>brms</code>) e o modelo converge na sua primeira tentativa.</p>
<p>Segundo, na abordagem frequentista, modelos multiníveis <a href="https://daijiang.name/en/2015/06/22/why-no-p-values-in-mixed-models/">não computam <span class="math inline">\(p\)</span>-valores dos efeitos de grupo</a> (veja a explicação <a href="https://stat.ethz.ch/pipermail/r-help/2006-May/094765.html">aqui do Douglas Bates autor do pacote <code>lme4</code></a>). Por conta da contorção matemática de diversas aproximações que a estatística frequentista tem que fazer (na sua determinação cega de não usar o teorema de Bayes pois conjecturas probabilísticas dos parâmetros são proibidas), o cálculo de <span class="math inline">\(p\)</span>-valores de efeitos de grupo possuem fortes pressupostos. O principal é que os grupos são balanceados. Ou seja, os grupos são homogêneos no seu tamanho. Qualquer desbalanço na composição dos grupos (um grupo com mais observações que outros) resulta em <span class="math inline">\(p\)</span>-valores patológicos e que não podem ser confiáveis.</p>
<p>Sumarizando, a abordagem frequentista para modelos multiníveis não é robusta tanto no processo da inferência (falhas de convergência da estimação de máxima verossimilhança), quanto nos resultados dessa inferência (não computa <span class="math inline">\(p\)</span>-valores por conta de fortes pressupostos que quase sempre são violados).</p>
<h2 id="três-abordagens-de-modelos-multiníveis">Três abordagens de Modelos Multiníveis</h2>
<p>Modelos multiníveis geralmente se dividem em três abordagens:</p>
<ol type="1">
<li><em>Random intercept model</em>: Modelo no qual cada grupo recebe uma constante (<em>intercept</em>) diferente além da constante global</li>
<li><em>Random slope model</em>: Modelo no qual cada grupo recebe um coeficiente diferente para cada variável independente além dos coeficientes globais</li>
<li><em>Random intercept-slope model</em>: Modelo no qual cada grupo recebe tanto uma constante (<em>intercept</em>) quanto um coeficiente diferente para cada variável independente além da constante global e dos coeficientes globais</li>
</ol>
<p><code>rstanarm</code> e <code>brms</code> possuem as funcionalidades completas para rodar modelos multiníveis e a única coisa a se fazer é alterar a fórmula. Para <code>rstanarm</code>, há uma segunda mudança também que não usamos mais a função <code>stan_glm()</code> mas sim a função <code>stan_glmer()</code>. Para <code>brms</code> não há mudança e usamos a mesma função <code>brm()</code>.</p>
<h3 id="random-intercept-model"><em>Random Intercept Model</em></h3>
<p>A primeira abordagem é o <em>random intercept model</em> na qual especificamos para cada grupo uma constante diferente, além da constante global. Essas constantes são amostradas de uma <em>hiperpriori</em>.</p>
<p>No caso de <em>random intercept model</em>, a fórmula a ser usada segue este padrão:</p>
<pre><code>y ~ (1 | group) + x1 + x2</code></pre>
<p>O <code>(1 | group)</code> na fórmula sinaliza que a constante <code>1</code> deve ser também especificada para cada um dos grupos listados nos valores da variável <code>group</code> (aqui você substitui <code>group</code> por qualquer variável que quiser). Na prática essa fórmula, tanto no <code>rstanarm</code> quanto no <code>brms</code> é expandida para:</p>
<pre><code>y ~ 1 + (1 | group) + x1 + x2</code></pre>
<p>Isto indica que há uma constante global (nível populacional) e também uma constante para cada grupo. Caso queira remover do modelo a constante global (algo que eu recomendo apenas se tiver <strong>muita fundamentação teórica</strong> para tal manobra) é só especificar o <code>0</code> como constante global. Isto sinaliza que o modelo possui apenas constantes para cada grupo e que não há uma constante global a ser estimada:</p>
<pre><code>y ~ 0 + (1 | group) + x1 + x2</code></pre>
<p>Além disso você pode especificar uma constante para quantos grupos quiser. É só adicioná-los na fórmula:</p>
<pre><code>y ~ (1 | group1) + (1 | group2) + x1 + x2</code></pre>
<h3 id="random-slope-model"><em>Random Slope Model</em></h3>
<p>A segunda abordagem é o <em>random slope model</em> na qual especificamos para cada grupo um coeficiente diferente para cada variável independente desejada, além dos coeficientes globais. Esses coeficientes são amostrados de uma <em>hiperpriori</em>.</p>
<p>No caso de <em>random slope model</em>, a formula a ser usada segue este padrão. Ela indica que o coeficiente da variável independente deve ser estimado de maneira global juntamente com coeficientes para cada grupo. Note que usamos o <code>0</code> pois neste caso sinalizamos que apenas a variável independente deve possuir coeficientes para cada grupo e não a constante:</p>
<pre><code>y ~ (0 + x1 | group) + (0 + x2 | group)</code></pre>
<p>Note que para <code>rstanarm</code> e <code>brms</code> a fórmula se transforma em:</p>
<pre><code>y ~ 1 + (0 + x1 | group) + (0 + x2 | group)</code></pre>
<p>Indicando que há uma constante global e coeficientes globais e de grupo para as variáveis independentes.</p>
<h3 id="random-intercept-slope-model"><em>Random Intercept-Slope Model</em></h3>
<p>A terceira abordagem é o <em>random intercept-slope model</em> na qual especificamos para cada grupo uma constante diferente juntamente com coeficientes diferentes para cada variável independente desejada. É claro também resulta em costante e coeficientes globais. Essas constantes e coeficientes à nível de grupo são amostrados de duas ou mais <em>hiperprioris</em>.</p>
<p>No caso de <em>random intercept-slope model</em>, a formula a ser usada segue este padrão:</p>
<pre><code>y ~ (1 + x1 | group) + (1 + x2 | group)</code></pre>
<p>Note novamente que para <code>rstanarm</code> e <code>brms</code> a fórmula se transforma em:</p>
<pre><code>y ~ 1 + (1 + x1 | group) + (1 + x2 | group)</code></pre>
<h2 id="prioris-de-modelos-multiníveis"><em>Prioris</em> de Modelos Multiníveis</h2>
<p>Antes de nos aventurarmos em estimar modelos, vamos relembrar as <em>prioris</em> da da <a href="4-Priors.html">Aula 4 - Priors</a>:</p>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 31%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Argumento</strong></th>
<th style="text-align: center;"><strong>Usado em</strong></th>
<th style="text-align: center;"><strong>Aplica-se à</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>prior_intercept</code></td>
<td style="text-align: center;">Todas funções de modelagem exceto <code>stan_polr</code> and <code>stan_nlmer</code></td>
<td style="text-align: center;">Constante (<em>intercept</em>) do modelo, após centralização dos preditores</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>prior</code></td>
<td style="text-align: center;">Todas funções de modelagem</td>
<td style="text-align: center;">Coeficientes de Regressão, não inclui coeficientes que variam por grupo em modelos multiníveis (veja <code>prior_covariance</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>prior_aux</code></td>
<td style="text-align: center;"><code>stan_glm</code>, <code>stan_glmer</code>, <code>stan_gamm4</code>, <code>stan_nlmer</code></td>
<td style="text-align: center;">Parâmetro auxiliar (ex: desvio padrão (<em>standard error</em> - DP), interpretação depende do modelo</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>prior_covariance</code></td>
<td style="text-align: center;"><code>stan_glmer</code>, <code>stan_gamm4</code>, <code>stan_nlmer</code></td>
<td style="text-align: center;">Matrizes de covariância em modelos multiníveis</td>
</tr>
</tbody>
</table>
<p>Em especial, foquem no <code>prior_covariance</code> que é a <em>priori</em> matriz de covariância em modelos multiníveis.</p>
<p>Os modelos hierárquicos geralmente são especificados assim. Temos <span class="math inline">\(N\)</span> observações organizadas em <span class="math inline">\(J\)</span> grupos com <span class="math inline">\(K\)</span> variáveis independentes. O truque aqui é que inserimos uma coluna de <span class="math inline">\(1\)</span> na matrix de dados <span class="math inline">\(\mathbf{X}\)</span>. Matematicamente isto se comporta como se esta coluna fosse uma variável de identidade (pois o número <span class="math inline">\(1\)</span> na operação de multiplicação <span class="math inline">\(1 \cdot \beta\)</span> é o elemento identidade. Ele mapeia <span class="math inline">\(x \to x\)</span> mantendo o valor de <span class="math inline">\(x\)</span>) e, consequentemente, podemos interpretar o coeficiente dessa coluna como a constante do modelo<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>Então temos os dados como uma matriz:</p>
<p><span class="math display">\[
\mathbf{X} =
\begin{bmatrix}
1 &amp; x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1K} \\
1 &amp; x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2K} \\
\vdots &amp; \cdots &amp; \cdots &amp; \ddots &amp; \vdots \\
1 &amp; x_{N1} &amp; x_{N2} &amp; \cdots &amp; x_{NK}
\end{bmatrix}
\]</span></p>
<p>Assim nosso modelo (aqui representado com uma função de verossimilhança Gaussiana/Normal) fica:</p>
<p><span class="math display">\[
\begin{aligned}
y &amp;\sim \text{Normal}(\alpha + \mathbf{X} \cdot \boldsymbol{\beta}_{j}, \sigma) \\
\boldsymbol{\beta}_j &amp;\sim \text{Normal Multivariada}(\boldsymbol{\mu}_j, \boldsymbol{\Sigma})
\quad \text{para}\quad j \in \{ 1, \dots, J \} \\
\alpha &amp;\sim \text{Normal}(\mu_\alpha, \sigma_\alpha) \\
\sigma &amp;\sim \text{Exponencial}(\lambda_\sigma)
\end{aligned}
\]</span></p>
<p>Cada vetor de coeficientes <span class="math inline">\(\boldsymbol{\beta}_j\)</span> representa os coeficientes das colunas de <span class="math inline">\(\mathbf{X}\)</span> para cada grupo <span class="math inline">\(j \in J\)</span>. Lembre-se que a primeira coluna de <span class="math inline">\(\mathbf{X}\)</span> é um monte de <span class="math inline">\(1\)</span>, então <span class="math inline">\(\beta_{j1}\)</span> é a constante para cada grupo. Junte isso com o que já vimos em aulas anteriores sobre <span class="math inline">\(\alpha\)</span> e <span class="math inline">\(\sigma\)</span> e temos um modelo multinível para um conjunto de grupos <span class="math inline">\(J\)</span>.</p>
<p>Caso queira mais grupos é só adicioná-los ao modelo como <span class="math inline">\(J_1, J_2, \dots\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
y &amp;\sim \text{Normal}(\alpha + \mathbf{X} \cdot \boldsymbol{\beta}_{j1} + \mathbf{X} \cdot \boldsymbol{\beta}_{j2}, \sigma) \\
\boldsymbol{\beta}_{j1} &amp;\sim \text{Normal Multivariada}(\boldsymbol{\mu}_{j1}, \boldsymbol{\Sigma}_1)
\quad \text{para}\quad j_1 \in \{ 1, \dots, J_1 \} \\
\boldsymbol{\beta}_{j2} &amp;\sim \text{Normal Multivariada}(\boldsymbol{\mu}_{j2}, \boldsymbol{\Sigma}_2)
\quad \text{para}\quad j_2 \in \{ 1, \dots, J_2 \} \\
\alpha &amp;\sim \text{Normal}(\mu_\alpha, \sigma_\alpha) \\
\sigma &amp;\sim \text{Exponencial}(\lambda_\sigma)
\end{aligned}
\]</span></p>
<p>Podemos especificar uma <em>priori</em> para a matriz de covariância <span class="math inline">\(\boldsymbol{\Sigma}\)</span> no <code>rstanarm</code> com <code>prior_covariance = decov(1)</code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>Para eficiência computacional o <code>rstanarm</code> modifica a matriz de covariância <span class="math inline">\(\boldsymbol{\Sigma}\)</span>. Especificamente, fazemos com que ela vire uma matriz de correlação. Toda matriz de covariância pode ser decomposta em:</p>
<p><span class="math display">\[
\boldsymbol{\Sigma}=\text{diag}_\text{matrix}(\boldsymbol{\tau}) \cdot \boldsymbol{\Omega} \cdot \text{diag}_\text{matrix}(\boldsymbol{\tau})
\]</span></p>
<p>na qual <span class="math inline">\(\boldsymbol{\Omega}\)</span> é uma matriz de correlação com <span class="math inline">\(1\)</span> na sua diagonal e os demais elementos entre -1 e 1 <span class="math inline">\(\rho \in (-1, 1)\)</span>. <span class="math inline">\(\boldsymbol{\tau}\)</span> é um vetor composto pelas variâncias das variáveis de <span class="math inline">\(\boldsymbol{\Sigma}\)</span> (a diagonal de <span class="math inline">\(\boldsymbol{\Sigma}\)</span>).</p>
<p>Adicionalmente a matriz de correlação <span class="math inline">\(\boldsymbol{\Omega}\)</span> pode ser decomposta mais uma vez para maior eficiência computacional. Como toda matriz de correlação é simétrica e definitiva positiva (todos seus autovalores são numeros reais <span class="math inline">\(\mathbb{R}\)</span> e positivos <span class="math inline">\(&gt;0\)</span>), podemos usar a <a href="https://en.wikipedia.org/wiki/Cholesky_decomposition">Decomposição Cholesky</a> para decompô-la em uma matriz triangular (que é muito mais eficiente computacionalmente):</p>
<p><span class="math display">\[
\boldsymbol{\Omega} = \mathbf{L}_\Omega \mathbf{L}^T_\Omega
\]</span></p>
<p>onde <span class="math inline">\(\mathbf{L}_\Omega\)</span> é uma matriz triangular.</p>
<p>O que falta é definirmos então uma <em>priori</em> para a matriz de correlação <span class="math inline">\(\boldsymbol{\Omega}\)</span>. Até pouco tempo atrás, usávamos uma distribuição de Wishart como <em>priori</em> <span class="citation" data-cites="gelman2013bayesian">(<a href="#ref-gelman2013bayesian" role="doc-biblioref">Gelman et al., 2013</a>)</span>. Mas essa prática foi abandonada após a proposição da distribuição LKJ de <span class="citation" data-cites="lewandowski2009generating"><a href="#ref-lewandowski2009generating" role="doc-biblioref">Lewandowski, Kurowicka, &amp; Joe</a> (<a href="#ref-lewandowski2009generating" role="doc-biblioref">2009</a>)</span> (LKJ são os nomes dos autores – <strong>L</strong>ewandowski, <strong>K</strong>urowicka e <strong>J</strong>oe) como <em>priori</em> de matrizes de correlação.</p>
<p>Enfim, embaixo do capô <code>rstanarm</code> faz todas essas decomposições e transformações para nós, sem termos que nos preocupar.</p>
<h2 id="exemplo-com-o-dataset-cheese">Exemplo com o <em>dataset</em> <code>cheese</code></h2>
<p>O <em>dataset</em> <a href="https://rdrr.io/cran/bayesm/man/cheese.html"><code>cheese</code></a> <span class="citation" data-cites="boatwright1999account">(<a href="#ref-boatwright1999account" role="doc-biblioref">Boatwright, McCulloch, &amp; Rossi, 1999</a>)</span> possui 160 observações de avaliações de queijo. Um grupo de 10 avaliadores “rurais” e 10 “urbanos” avaliaram 4 queijos diferentes <span class="math inline">\((A,B,C,D)\)</span> em duas amostras. Portanto <span class="math inline">\(4 \cdot 20 \cdot 2 = 160\)</span>. Possui 4 variáveis:</p>
<ul>
<li><code>cheese</code>: tipo do queijo, <span class="math inline">\((A,B,C,D)\)</span></li>
<li><code>rater</code>: avaliador, <span class="math inline">\((1,\dots, 10)\)</span></li>
<li><code>background</code>: origem do avaliador em “urbano” ou “rural”</li>
<li><code>y</code>: variável dependente, nota da avaliação</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cheese</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv2</a></span><span class='op'>(</span><span class='st'>"datasets/cheese.csv"</span>, col_types <span class='op'>=</span> <span class='st'>"fffi"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Como sempre eu gosto de usar o pacote <code>skimr</code> <span class="citation" data-cites="skimr">(<a href="#ref-skimr" role="doc-biblioref">Waring et al., 2021</a>)</span> com a função <code>skim()</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/skimr/'>skimr</a></span><span class='op'>)</span>
<span class='fu'><a href='https://docs.ropensci.org/skimr/reference/skim.html'>skim</a></span><span class='op'>(</span><span class='va'>cheese</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:cheese-skim">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">cheese</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">160</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cheese</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">A: 40, B: 40, C: 40, D: 40</td>
</tr>
<tr class="even">
<td style="text-align: left;">rater</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">1: 16, 2: 16, 3: 16, 4: 16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">background</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">rur: 80, urb: 80</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">y</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">91</td>
<td style="text-align: left;">▁▂▆▇▆</td>
</tr>
</tbody>
</table>
</div>
<h3 id="random-intercept-model-1"><em>Random Intercept Model</em></h3>
<p>No primeiro exemplo vamos usar um modelo que cada grupo de <code>cheese</code> recebe uma constante diferente:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Detectar quantos cores/processadores</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>mc.cores <span class='op'>=</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>Ncpus <span class='op'>=</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/rstanarm/'>rstanarm</a></span><span class='op'>)</span>
<span class='va'>random_intercept</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>stan_glmer</a></span><span class='op'>(</span>
  <span class='va'>y</span> <span class='op'>~</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>cheese</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>background</span>,
  data <span class='op'>=</span> <span class='va'>cheese</span>,
  prior_intercept <span class='op'>=</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>cheese</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span>, <span class='fl'>2.5</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>cheese</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>,
  prior_covariance <span class='op'>=</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>decov</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>No sumário do modelo <em>random intercept</em> vemos que os avaliadores urbanos avaliam melhor os queijos que os avaliadores rurais, mas também observamos que cada queijo possui uma “taxa basal” de avaliação (cada queijo tem sua constante). Sendo <span class="math inline">\(B\)</span> o pior queijo e <span class="math inline">\(C\)</span> o melhor queijo:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>random_intercept</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Model Info:
 function:     stan_glmer
 family:       gaussian [identity]
 formula:      y ~ (1 | cheese) + background
 algorithm:    sampling
 sample:       4000 (posterior sample size)
 priors:       see help(&#39;prior_summary&#39;)
 observations: 160
 groups:       cheese (4)

Estimates:
                                        mean   sd    10%   50%   90%
(Intercept)                            67.3    5.5  60.8  67.2  73.8
backgroundurban                         7.4    1.1   5.9   7.4   8.9
b[(Intercept) cheese:A]                 3.7    5.6  -2.8   3.9  10.4
b[(Intercept) cheese:B]               -14.2    5.6 -20.9 -14.0  -7.6
b[(Intercept) cheese:C]                 8.4    5.6   1.9   8.5  15.2
b[(Intercept) cheese:D]                 1.3    5.6  -5.3   1.4   8.0
sigma                                   7.1    0.4   6.6   7.1   7.6
Sigma[cheese:(Intercept),(Intercept)] 131.6  118.4  42.4  95.2 254.7

Fit Diagnostics:
           mean   sd   10%   50%   90%
mean_PPD 70.9    0.8 69.9  70.9  71.9 

The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help(&#39;summary.stanreg&#39;)).

MCMC diagnostics
                                      mcse Rhat n_eff
(Intercept)                           0.2  1.0  1315 
backgroundurban                       0.0  1.0  3392 
b[(Intercept) cheese:A]               0.2  1.0  1337 
b[(Intercept) cheese:B]               0.2  1.0  1346 
b[(Intercept) cheese:C]               0.2  1.0  1349 
b[(Intercept) cheese:D]               0.2  1.0  1343 
sigma                                 0.0  1.0  3576 
Sigma[cheese:(Intercept),(Intercept)] 3.0  1.0  1579 
mean_PPD                              0.0  1.0  3719 
log-posterior                         0.1  1.0  1241 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
<p>Vamos verificar o <em>Posterior Predictive Check</em> do modelo <em>random intercept</em> na figura <a href="#fig:pp-check-random-intercept">3</a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/pp_check.stanreg.html'>pp_check</a></span><span class='op'>(</span><span class='va'>random_intercept</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:pp-check-random-intercept"></span>
<img src="10-Regressao_Multinivel_files/figure-html5/pp-check-random-intercept-1.png" alt="*Posterior Preditive Check* do modelo *random intercept*" width="624" />
<p class="caption">
Figure 3: <em>Posterior Preditive Check</em> do modelo <em>random intercept</em>
</p>
</div>
</div>
<h3 id="random-slope-model-1"><em>Random Slope Model</em></h3>
<p>No segundo exemplo vamos usar um modelo que cada grupo de <code>cheese</code> recebe um coeficiente diferente para <code>background</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>random_slope</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>stan_glmer</a></span><span class='op'>(</span>
  <span class='va'>y</span> <span class='op'>~</span> <span class='op'>(</span><span class='fl'>0</span> <span class='op'>+</span> <span class='va'>background</span> <span class='op'>|</span> <span class='va'>cheese</span><span class='op'>)</span>,
  data <span class='op'>=</span> <span class='va'>cheese</span>,
  prior_intercept <span class='op'>=</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>cheese</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span>, <span class='fl'>2.5</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>cheese</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>,
  prior_covariance <span class='op'>=</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>decov</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Aqui vemos que todos os queijos recebem a mesma constante mas cada queijo possui um coeficiente diferente para <code>background</code> do avaliador:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>random_slope</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Model Info:
 function:     stan_glmer
 family:       gaussian [identity]
 formula:      y ~ (0 + background | cheese)
 algorithm:    sampling
 sample:       4000 (posterior sample size)
 priors:       see help(&#39;prior_summary&#39;)
 observations: 160
 groups:       cheese (4)

Estimates:
                                                mean   sd    10%
(Intercept)                                    69.9    5.9  62.9
b[backgroundrural cheese:A]                     0.8    6.0  -6.5
b[backgroundurban cheese:A]                     8.8    6.1   1.5
b[backgroundrural cheese:B]                   -15.7    6.2 -23.2
b[backgroundurban cheese:B]                   -10.3    5.9 -17.4
b[backgroundrural cheese:C]                     5.4    5.9  -1.9
b[backgroundurban cheese:C]                    13.7    6.1   6.2
b[backgroundrural cheese:D]                    -0.7    6.0  -7.7
b[backgroundurban cheese:D]                     5.4    6.0  -1.9
sigma                                           7.1    0.4   6.6
Sigma[cheese:backgroundrural,backgroundrural] 134.0  121.8  40.6
Sigma[cheese:backgroundurban,backgroundrural]  76.4  102.8   3.4
Sigma[cheese:backgroundurban,backgroundurban] 167.7  164.0  52.2
                                                50%   90%
(Intercept)                                    70.1  76.9
b[backgroundrural cheese:A]                     0.7   7.9
b[backgroundurban cheese:A]                     8.5  16.0
b[backgroundrural cheese:B]                   -15.8  -8.1
b[backgroundurban cheese:B]                   -10.4  -3.3
b[backgroundrural cheese:C]                     5.2  12.5
b[backgroundurban cheese:C]                    13.5  21.1
b[backgroundrural cheese:D]                    -0.7   6.5
b[backgroundurban cheese:D]                     5.3  12.9
sigma                                           7.1   7.6
Sigma[cheese:backgroundrural,backgroundrural]  99.0 262.6
Sigma[cheese:backgroundurban,backgroundrural]  52.6 172.9
Sigma[cheese:backgroundurban,backgroundurban] 120.3 328.3

Fit Diagnostics:
           mean   sd   10%   50%   90%
mean_PPD 70.8    0.8 69.8  70.8  71.8 

The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help(&#39;summary.stanreg&#39;)).

MCMC diagnostics
                                              mcse Rhat n_eff
(Intercept)                                   0.2  1.0   722 
b[backgroundrural cheese:A]                   0.2  1.0   726 
b[backgroundurban cheese:A]                   0.2  1.0   744 
b[backgroundrural cheese:B]                   0.2  1.0   738 
b[backgroundurban cheese:B]                   0.2  1.0   774 
b[backgroundrural cheese:C]                   0.2  1.0   736 
b[backgroundurban cheese:C]                   0.2  1.0   742 
b[backgroundrural cheese:D]                   0.2  1.0   744 
b[backgroundurban cheese:D]                   0.2  1.0   721 
sigma                                         0.0  1.0  3567 
Sigma[cheese:backgroundrural,backgroundrural] 2.8  1.0  1958 
Sigma[cheese:backgroundurban,backgroundrural] 3.0  1.0  1140 
Sigma[cheese:backgroundurban,backgroundurban] 5.0  1.0  1077 
mean_PPD                                      0.0  1.0  3749 
log-posterior                                 0.1  1.0  1105 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
<p>Vamos verificar o <em>Posterior Predictive Check</em> do modelo <em>random slope</em> na figura <a href="#fig:pp-check-random-slope">4</a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/pp_check.stanreg.html'>pp_check</a></span><span class='op'>(</span><span class='va'>random_slope</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:pp-check-random-slope"></span>
<img src="10-Regressao_Multinivel_files/figure-html5/pp-check-random-slope-1.png" alt="*Posterior Preditive Check* do modelo *random slope*" width="624" />
<p class="caption">
Figure 4: <em>Posterior Preditive Check</em> do modelo <em>random slope</em>
</p>
</div>
</div>
<h3 id="random-intercept-slope-model-1"><em>Random Intercept-Slope Model</em></h3>
<p>No terceiro exemplo vamos usar um modelo que cada grupo de <code>cheese</code> recebe uma constante diferente e um coeficiente diferente para <code>background</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>random_intercept_slope</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>stan_glmer</a></span><span class='op'>(</span>
  <span class='va'>y</span> <span class='op'>~</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>background</span> <span class='op'>|</span> <span class='va'>cheese</span><span class='op'>)</span>,
  data <span class='op'>=</span> <span class='va'>cheese</span>,
  prior_intercept <span class='op'>=</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>cheese</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span>, <span class='fl'>2.5</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>cheese</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>,
  prior_covariance <span class='op'>=</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>decov</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Aqui vemos que os queijos recebem a constantes diferentes e que cada queijo possui um coeficiente diferente para background do avaliador:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>random_intercept_slope</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Model Info:
 function:     stan_glmer
 family:       gaussian [identity]
 formula:      y ~ (1 + background | cheese)
 algorithm:    sampling
 sample:       4000 (posterior sample size)
 priors:       see help(&#39;prior_summary&#39;)
 observations: 160
 groups:       cheese (4)

Estimates:
                                                mean   sd    10%
(Intercept)                                    65.0    7.6  55.4
b[(Intercept) cheese:A]                         5.8    7.6  -3.3
b[backgroundurban cheese:A]                     7.8    2.2   5.0
b[(Intercept) cheese:B]                       -10.5    7.9 -20.0
b[backgroundurban cheese:B]                     4.6    2.3   1.6
b[(Intercept) cheese:C]                        10.2    7.5   1.1
b[backgroundurban cheese:C]                     8.4    2.2   5.5
b[(Intercept) cheese:D]                         4.2    7.6  -4.8
b[backgroundurban cheese:D]                     6.0    2.2   3.3
sigma                                           7.1    0.4   6.6
Sigma[cheese:(Intercept),(Intercept)]         157.1  168.0  43.7
Sigma[cheese:backgroundurban,(Intercept)]      24.5   76.0 -46.8
Sigma[cheese:backgroundurban,backgroundurban]  84.9   81.0  25.2
                                                50%   90%
(Intercept)                                    65.2  74.0
b[(Intercept) cheese:A]                         5.6  15.4
b[backgroundurban cheese:A]                     7.8  10.6
b[(Intercept) cheese:B]                       -10.5  -0.8
b[backgroundurban cheese:B]                     4.6   7.6
b[(Intercept) cheese:C]                        10.1  19.7
b[backgroundurban cheese:C]                     8.4  11.2
b[(Intercept) cheese:D]                         4.1  13.8
b[backgroundurban cheese:D]                     6.1   8.8
sigma                                           7.1   7.7
Sigma[cheese:(Intercept),(Intercept)]         111.1 308.9
Sigma[cheese:backgroundurban,(Intercept)]      17.0 102.5
Sigma[cheese:backgroundurban,backgroundurban]  60.7 165.7

Fit Diagnostics:
           mean   sd   10%   50%   90%
mean_PPD 70.8    0.8 69.8  70.8  71.9 

The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help(&#39;summary.stanreg&#39;)).

MCMC diagnostics
                                              mcse Rhat n_eff
(Intercept)                                   0.3  1.0   788 
b[(Intercept) cheese:A]                       0.3  1.0   810 
b[backgroundurban cheese:A]                   0.0  1.0  4942 
b[(Intercept) cheese:B]                       0.3  1.0   786 
b[backgroundurban cheese:B]                   0.0  1.0  2615 
b[(Intercept) cheese:C]                       0.3  1.0   804 
b[backgroundurban cheese:C]                   0.0  1.0  4562 
b[(Intercept) cheese:D]                       0.3  1.0   808 
b[backgroundurban cheese:D]                   0.0  1.0  4895 
sigma                                         0.0  1.0  3967 
Sigma[cheese:(Intercept),(Intercept)]         4.2  1.0  1595 
Sigma[cheese:backgroundurban,(Intercept)]     2.4  1.0   989 
Sigma[cheese:backgroundurban,backgroundurban] 1.9  1.0  1746 
mean_PPD                                      0.0  1.0  3604 
log-posterior                                 0.1  1.0  1168 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
<p>Por fim, vamos verificar o <em>Posterior Predictive Check</em> do modelo <em>random intercept-slope</em> na figura <a href="#fig:pp-check-random-intercept-slope">5</a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/pp_check.stanreg.html'>pp_check</a></span><span class='op'>(</span><span class='va'>random_intercept_slope</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:pp-check-random-intercept-slope"></span>
<img src="10-Regressao_Multinivel_files/figure-html5/pp-check-random-intercept-slope-1.png" alt="*Posterior Preditive Check* do modelo *random intercept-slope*" width="624" />
<p class="caption">
Figure 5: <em>Posterior Preditive Check</em> do modelo <em>random intercept-slope</em>
</p>
</div>
</div>
<h2 id="modelos-multiníveis-no-brms">Modelos multiníveis no <code>brms</code></h2>
<p>O <code>brms</code> tem uma pequena diferença no output do sumário do modelo. Aqui especificamos a <em>priori</em> da matriz de covariância um pouco diferente com <code>prior(lkj_corr_cholesky(1), class = L)</code> que é o mesmo que <code>prior_covariance = decov(1)</code> do <code>rstanarm</code>:</p>
<blockquote>
<p>OBS: 79 é a média de <code>cheese$y</code> e 21 é 2.5x o desvio padrão de <code>cheese$y</code>.</p>
</blockquote>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/paul-buerkner/brms'>brms</a></span><span class='op'>)</span>

<span class='va'>brms_random_intercept_slope</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span>
  <span class='va'>y</span> <span class='op'>~</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>background</span> <span class='op'>|</span> <span class='va'>cheese</span><span class='op'>)</span>,
  data <span class='op'>=</span> <span class='va'>cheese</span>,
  prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span><span class='op'>(</span><span class='fl'>71</span>, <span class='fl'>29</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='va'>Intercept</span><span class='op'>)</span>,
    <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>lkj_corr_cholesky</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='va'>L</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Veja o output do <code>summary()</code> para modelos multiníveis estimados pelo <code>brms</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>brms_random_intercept_slope</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: y ~ (1 + background | cheese) 
   Data: cheese (Number of observations: 160) 
Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup samples = 4000

Group-Level Effects: 
~cheese (Number of levels: 4) 
                               Estimate Est.Error l-95% CI u-95% CI
sd(Intercept)                     13.00      5.74     5.79    27.61
sd(backgroundurban)                8.98      4.18     3.87    20.25
cor(Intercept,backgroundurban)     0.18      0.53    -0.80     0.97
                               Rhat Bulk_ESS Tail_ESS
sd(Intercept)                  1.00     1426     1964
sd(backgroundurban)            1.00     1328     1918
cor(Intercept,backgroundurban) 1.00      678      970

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    65.51      9.41    45.18    84.70 1.00      656     1042

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     7.11      0.41     6.36     7.96 1.00     2799     2530

Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<p>Não há menção dos efeitos de grupo. Para isso precisamos usar a função <code>ranef()</code> (uma abreviação de <em><strong>ran</strong>dom <strong>ef</strong>fects</em>). Caso queira somente os efeitos populacionais pode usar a função <code>fixef()</code> (uma abreviação de <em><strong>fix</strong>ed <strong>ef</strong>fects</em>):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/ranef.brmsfit.html'>ranef</a></span><span class='op'>(</span><span class='va'>brms_random_intercept_slope</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$cheese
, , Intercept

  Estimate Est.Error Q2.5 Q97.5
A      5.3       9.5  -14  25.9
B    -11.0       9.7  -31   9.8
C      9.8       9.3   -9  30.0
D      3.8       9.4  -15  24.0

, , backgroundurban

  Estimate Est.Error  Q2.5 Q97.5
A      7.8       2.2 3.451  12.1
B      4.8       2.3 0.066   9.3
C      8.3       2.2 3.979  12.6
D      6.0       2.1 1.896  10.1</code></pre>
</div>
<h2 id="atividade-prática">Atividade Prática</h2>
<p>Para atividade prática, temos o <em>dataset</em> <code>rikz</code><span class="citation" data-cites="zuur2007analyzing">(<a href="#ref-zuur2007analyzing" role="doc-biblioref">Zuur, Ieno, &amp; Smith, 2007</a>)</span> no diretório <code>datasets/</code> (figura <a href="#fig:fig-rikz">6</a>). Segue a descrição em inglês do <em>dataset</em>.</p>
<p>For each of 9 intertidal areas (denoted ‘Beaches’), the researchers sampled five sites (denoted ‘Sites’) and at each site they measured abiotic variables and the diversity of macro-fauna (e.g. aquatic invertebrates). Here, species richness refers to the total number of species found at a given site while NAP ( i.e. Normal Amsterdams Peil) refers to the height of the sampling location relative to the mean sea level and represents a measure of the amount of food available for birds, etc. For our purpose, the main question is:</p>
<p><strong>What is the influence of NAP on species richness?</strong></p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:fig-rikz"></span>
<img src="images/RIKZ_data.png" alt="*Dataset* `rikz`" width="684" />
<p class="caption">
Figure 6: <em>Dataset</em> <code>rikz</code>
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rikz</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv2</a></span><span class='op'>(</span><span class='st'>"datasets/rikz.csv"</span>, col_types <span class='op'>=</span> <span class='st'>"iidff"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="ambiente">Ambiente</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/sessionInfo.html'>sessionInfo</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>R version 4.0.4 (2021-02-15)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods  
[7] base     

other attached packages:
 [1] brms_2.15.0     rstanarm_2.21.1 Rcpp_1.0.6      skimr_2.1.3    
 [5] readr_1.4.0     readxl_1.3.1    tibble_3.1.0    ggplot2_3.3.3  
 [9] patchwork_1.1.1 cowplot_1.1.1  

loaded via a namespace (and not attached):
  [1] backports_1.2.1      systemfonts_1.0.1    plyr_1.8.6          
  [4] igraph_1.2.6         repr_1.1.3           splines_4.0.4       
  [7] crosstalk_1.1.1      TH.data_1.0-10       rstantools_2.1.1    
 [10] inline_0.3.17        digest_0.6.27        htmltools_0.5.1.1   
 [13] magick_2.7.1         rsconnect_0.8.16     fansi_0.4.2         
 [16] magrittr_2.0.1       RcppParallel_5.0.3   matrixStats_0.58.0  
 [19] sandwich_3.0-0       xts_0.12.1           prettyunits_1.1.1   
 [22] jpeg_0.1-8.1         colorspace_2.0-0     textshaping_0.3.3   
 [25] xfun_0.22            dplyr_1.0.5          callr_3.6.0         
 [28] crayon_1.4.1         jsonlite_1.7.2       lme4_1.1-26         
 [31] survival_3.2-10      zoo_1.8-9            glue_1.4.2          
 [34] gtable_0.3.0         emmeans_1.5.5-1      V8_3.4.0            
 [37] pkgbuild_1.2.0       rstan_2.21.2         abind_1.4-5         
 [40] scales_1.1.1         mvtnorm_1.1-1        DBI_1.1.1           
 [43] miniUI_0.1.1.1       xtable_1.8-4         stats4_4.0.4        
 [46] StanHeaders_2.21.0-7 DT_0.17              htmlwidgets_1.5.3   
 [49] threejs_0.3.3        ellipsis_0.3.1       pkgconfig_2.0.3     
 [52] loo_2.4.1            farver_2.1.0         sass_0.3.1          
 [55] utf8_1.2.1           tidyselect_1.1.0     labeling_0.4.2      
 [58] rlang_0.4.10         reshape2_1.4.4       later_1.1.0.1       
 [61] munsell_0.5.0        cellranger_1.1.0     tools_4.0.4         
 [64] cli_2.3.1            generics_0.1.0       ggridges_0.5.3      
 [67] evaluate_0.14        stringr_1.4.0        fastmap_1.1.0       
 [70] yaml_2.2.1           ragg_1.1.2           processx_3.5.0      
 [73] knitr_1.31           purrr_0.3.4          nlme_3.1-152        
 [76] projpred_2.0.2       mime_0.10            xml2_1.3.2          
 [79] compiler_4.0.4       bayesplot_1.8.0      shinythemes_1.2.0   
 [82] rstudioapi_0.13      gamm4_0.2-6          curl_4.3            
 [85] png_0.1-7            statmod_1.4.35       bslib_0.2.4         
 [88] stringi_1.5.3        highr_0.8            ps_1.6.0            
 [91] Brobdingnag_1.2-6    lattice_0.20-41      Matrix_1.3-2        
 [94] nloptr_1.2.2.2       markdown_1.1         shinyjs_2.0.0       
 [97] vctrs_0.3.6          pillar_1.5.1         lifecycle_1.0.0     
[100] jquerylib_0.1.3      bridgesampling_1.0-0 estimability_1.3    
[103] httpuv_1.5.5         R6_2.5.0             bookdown_0.21       
[106] promises_1.2.0.1     gridExtra_2.3        codetools_0.2-18    
[109] distill_1.2          boot_1.3-27          colourpicker_1.1.0  
[112] MASS_7.3-53.1        gtools_3.8.2         assertthat_0.2.1    
[115] rprojroot_2.0.2      withr_2.4.1          shinystan_2.5.0     
[118] multcomp_1.4-16      mgcv_1.8-34          parallel_4.0.4      
[121] hms_1.0.0            grid_4.0.4           tidyr_1.1.3         
[124] coda_0.19-4          minqa_1.2.4          rmarkdown_2.7       
[127] downlit_0.2.1        shiny_1.6.0          lubridate_1.7.10    
[130] base64enc_0.1-3      dygraphs_1.1.1.6    </code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="doc-bibliography">
<div id="ref-lme4" class="csl-entry" role="doc-biblioentry">
Bates, D., Mächler, M., Bolker, B., &amp; Walker, S. (2015). Fitting linear mixed-effects models using <span class="nocase">lme4</span>. <em>Journal of Statistical Software</em>, <em>67</em>(1), 1–48. <a href="https://doi.org/10.18637/jss.v067.i01">https://doi.org/10.18637/jss.v067.i01</a>
</div>
<div id="ref-boatwright1999account" class="csl-entry" role="doc-biblioentry">
Boatwright, P., McCulloch, R., &amp; Rossi, P. (1999). Account-level modeling for trade promotion: An application of a constrained parameter hierarchical model. <em>Journal of the American Statistical Association</em>, <em>94</em>(448), 1063–1073.
</div>
<div id="ref-definettiTheoryProbability1974" class="csl-entry" role="doc-biblioentry">
de Finetti, B. (1974). <em>Theory of <span>Probability</span></em> (Volume 1). <span>New York</span>: <span>John Wiley &amp; Sons</span>.
</div>
<div id="ref-gelman2013bayesian" class="csl-entry" role="doc-biblioentry">
Gelman, A., Carlin, J. B., Stern, H. S., Dunson, D. B., Vehtari, A., &amp; Rubin, D. B. (2013). <em>Bayesian <span>Data Analysis</span></em>. <span>Chapman and Hall/CRC</span>.
</div>
<div id="ref-lewandowski2009generating" class="csl-entry" role="doc-biblioentry">
Lewandowski, D., Kurowicka, D., &amp; Joe, H. (2009). Generating random correlation matrices based on vines and extended onion method. <em>Journal of Multivariate Analysis</em>, <em>100</em>(9), 1989–2001.
</div>
<div id="ref-nauFinettiWasRight2001" class="csl-entry" role="doc-biblioentry">
Nau, R. F. (2001). De <span>Finetti</span> was <span>Right</span>: <span>Probability Does Not Exist</span>. <em>Theory and Decision</em>, <em>51</em>(2), 89–124. <a href="https://doi.org/10.1023/A:1015525808214">https://doi.org/10.1023/A:1015525808214</a>
</div>
<div id="ref-skimr" class="csl-entry" role="doc-biblioentry">
Waring, E., Quinn, M., McNamara, A., Arino de la Rubia, E., Zhu, H., &amp; Ellis, S. (2021). <em>Skimr: Compact and flexible summaries of data</em>. Retrieved from <a href="https://CRAN.R-project.org/package=skimr">https://CRAN.R-project.org/package=skimr</a>
</div>
<div id="ref-zuur2007analyzing" class="csl-entry" role="doc-biblioentry">
Zuur, A., Ieno, E. N., &amp; Smith, G. M. (2007). <em>Analyzing ecological data</em>. Springer.
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>do inglês <em>exchangeability</em>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>por isso que nas fórmulas do <code>R</code> o <code>1</code> é interpretado como a constante do modelo. Substitua-o por uma coluna de <span class="math inline">\(0\)</span> de temos um modelo sem constante, por isso o <code>0</code> nas fórmulas é interpretado como um modelo ausente de constante.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p><code>decov(1)</code> é basicamente uma <em>priori</em> uniforme.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/storopoli/Estatistica-Bayesiana/issues/new">create an issue</a> on the source repository.</p>
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>. Source code is available at <a href="https://github.com/storopoli/Estatistica-Bayesiana">https://github.com/storopoli/Estatistica-Bayesiana</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
<h3 id="citation">Citation</h3>
<p>For attribution, please cite this work as</p>
<pre class="citation-appendix short">Storopoli (2021, Aug. 1). Estatística Bayesiana com R e Stan: Modelos Multiníveis Bayesianos. Retrieved from https://storopoli.io/Estatistica-Bayesiana/10-Regressao_Multinivel.html</pre>
<p>BibTeX citation</p>
<pre class="citation-appendix long">@misc{storopoli2021regressaomultinivelbayesR,
  author = {Storopoli, Jose},
  title = {Estatística Bayesiana com R e Stan: Modelos Multiníveis Bayesianos},
  url = {https://storopoli.io/Estatistica-Bayesiana/10-Regressao_Multinivel.html},
  year = {2021}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p>© Copyright 2021 <a href="https://github.com/storopoli/Estatistica-Bayesiana">Jose Storopoli</a>.</p>
<p>Content licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
